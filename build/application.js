angular.module("myApp",["ngRoute","firebase","angular-google-gapi"]).constant("FirebaseUrl","https://blinding-inferno-8283.firebaseio.com/").config(["$routeProvider",function($routeProvider){$routeProvider.when("/",{controller:"landingPageController as landingPage",templateUrl:"app/landingPage/landingPage.tpl.html"}).otherwise({redirectTo:"/"})}]).run(["GAuth","GApi","GData","$rootScope","appUserManager",function(GAuth,GApi,GData,$rootScope,appUserManager){$rootScope.gdata=GData;var CLIENT="901439137249-3aulv1h92rntb6c4lav87e4q1uo63kq7.apps.googleusercontent.com";GApi.load("gmail","v1"),GApi.load("calendar","v3"),GAuth.setClient(CLIENT),GAuth.setScope("https://www.googleapis.com/auth/userinfo.email https://www.googleapis.com/auth/calendar.readonly https://mail.google.com/ https://www.googleapis.com/auth/gmail.readonly"),GAuth.load().then(function(){console.log("loaded"),console.log(GData.isLogin())})}]),angular.module("myApp").service("appUserManager",["Auth",function(Auth){return{currentUser:{},accessToken:""}}]),angular.module("myApp").factory("Auth",["$firebaseAuth","FirebaseUrl",function($firebaseAuth,FirebaseUrl){var auth=$firebaseAuth();return auth}]),angular.module("myApp").directive("googleAuthentication",["firebase","Auth","appUserManager","GAuth","$window",function(firebase,Auth,appUserManager,GAuth,$window){var googleAuthController=["$scope",function($scope){$scope.auth=Auth,$scope.isUserEqual=function(googleUser,firebaseUser){if(firebaseUser)for(var providerData=firebaseUser.providerData,i=0;i<providerData.length;i++)if(providerData[i].providerId===firebase.auth.GoogleAuthProvider.PROVIDER_ID&&providerData[i].uid===googleUser.id)return!0;return!1},$scope.googleSignIn=function(){GAuth.login().then(function(googleUser){var unsubscribe=firebase.auth().onAuthStateChanged(function(firebaseUser){if(unsubscribe(),console.log(firebaseUser,googleUser),$scope.isUserEqual(googleUser,firebaseUser))console.log("User already signed-in Firebase.");else{var credential="";GAuth.getToken().then(function(result){console.log(result),credential=firebase.auth.GoogleAuthProvider.credential(result.id_token),firebase.auth().signInWithCredential(credential)["catch"](function(error){error.code,error.message,error.email,error.credential})})}appUserManager.currentUser=googleUser,GAuth.getToken().then(function(result){appUserManager.accessToken=result})})})}}];return{templateUrl:"/app/auth/googleAuth.tpl.html",controller:googleAuthController,controllerAs:"googleAuthCtrl"}}]),angular.module("myApp").service("localFirebaseService",["Auth","$firebaseObject","$q",function(Auth,$firebaseObject,$q){return{setCurrentUserData:function(path,data){var defer=$q.defer(),firebaseUser=Auth.$getAuth(),uid=firebaseUser.uid,obj=$firebaseObject(firebase.database().ref("users/"+uid+path));return obj.foo="bar",obj.$save().then(function(ref){return ref.key===obj.$id,defer.resolve(ref)},function(error){return console.log("Error:",error),defer.reject}),defer.promise}}}]),angular.module("myApp").service("googleApiService",["GApi",function(GApi){return{loadGmailMessages:function(){}}}]),angular.module("myApp").controller("landingPageController",["$scope","$timeout","localFirebaseService",function($scope,$timeout,localFirebaseService){$scope.salutation="Hello there, world!",$scope.someOther="There is nothing here",$scope.userPrefBtnTitle="Test save",$scope.saveUserData=function(){$scope.userPrefBtnTitle="Saving...",localFirebaseService.setCurrentUserData("/userPrefs",{panelsOpen:"none"}).then(function(result){$scope.userPrefBtnTitle="Saved!",$timeout(function(){$scope.userPrefBtnTitle="Test save"},1e3)},function(error){$scope.userPrefBtnTitle=error})}}]),angular.module("myApp").directive("navigationBar",["googleApiService","GApi","GAuth","appUserManager",function(googleApiService,GApi,GAuth,appUserManager){var navigationBarController=["$scope",function($scope){}],navBarLink=function(scope,elem,attrs){};return{templateUrl:"/app/navigationBar/navigationBar.tpl.html",controller:navigationBarController,controllerAs:"navBarCtrl",link:navBarLink}}]),angular.module("myApp").directive("searchPanel",["$timeout",function($timeout){var searchPanelController=["$scope",function($scope){console.log("controller"),$scope.loadingPlaceholder="Hey, still loading!"}];return{templateUrl:"/app/searchPanel/search_panel.tpl.html",controller:searchPanelController,controllerAs:"searchPanelCtrl",replace:!0,scope:!1,link:function(scope,elem,attrs){console.log("link"),$timeout(function(){scope.loadingPlaceholder="Loaded"},1e3)}}}]);